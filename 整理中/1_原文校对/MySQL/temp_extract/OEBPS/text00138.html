<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" style="font-size:1.250rem;">
<head><title></title>
<link href="flow0001.css" rel="stylesheet" type="text/css" />
</head>
<body>
<h3 class="p3">9.5.2　用于恢复的MySQL配置文件</h3>
<p class="ziti">先创建存放MySQL日志文件的目录，将MySQL日志和数据文件分离到不同的目录中，以便于Xtrabackup恢复正式数据：</p>
<hr/>
<pre class="ziti1">[root@oldboy mysql]# mkdir /application/mysql/logs -p
[root@oldboy mysql]# chown -R mysql.mysql /application/mysql/logs</pre>
<hr/>
<p class="ziti">然后，修改MySQL的配置文件，把二进制日志、错误日志、慢查询日志从MySQL数据文件目录中迁移出来，并增加数据文件对应的目录。</p>
<hr/>
<pre class="ziti1">[root@oldboy mysql]# egrep -v "#|^$" /etc/my.cnf
[client]
user=root
password=oldboy123
[mysqld]
basedir = /application/mysql/                 #&lt;==增加MySQL根目录。
datadir = /application/mysql/data/            #&lt;==MySQL数据目录，Xtrabackup
                                               恢复数据时需要这个目录。
###########binlog############
log_bin = /application/mysql/logs/oldboy-bin  #&lt;==二进制日志路径调整，尽可能在
                                              装数据库前就调整好。
expire_logs_days = 7
###########slow log###########
slow-query-log = ON
long_query_time = 2
log_queries_not_using_indexes = ON
slow-query-log-file = /application/mysql/logs/slow.log  #&lt;==慢查询日志路径调整。
min_examined_row_limit = 800
[mysqld_safe]
log-error = /application/mysql/logs/oldboy.err         #&lt;==慢查询日志路径调整。
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</pre>
<hr/>
<p class="ziti6"><img alt="" class="formula-1-5em" src="Image00006.jpg" />
 <span class="yanse">提示：</span>
 上面注释过的行就是增加或更改的参数，其他参数和前面章节使用的一致。</p>
<p class="ziti">调整完配置文件，别忘了重启MySQL：</p>
<hr/>
<pre class="ziti1">[root@oldboy ~]# /etc/init.d/mysqld restart
Shutting down MySQL.. SUCCESS!
Starting MySQL. SUCCESS!</pre>
<hr/>
<p class="ziti">需要特别强调的是，其实本节实现MySQL配置文件的调整，就是为了后文直接使用Xtrabackup（--copy-back）将数据文件还原到数据文件的目录中，如果使用mv等命令移动还原数据文件，则可以不调整本节的参数。</p>
</body>
</html>
