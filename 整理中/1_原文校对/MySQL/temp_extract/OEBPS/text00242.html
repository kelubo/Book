<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" style="font-size:1.250rem;">
<head><title></title>
<link href="flow0001.css" rel="stylesheet" type="text/css" />
</head>
<body>
<h3 class="p3">16.2.2　MySQL主主复制能够解决的企业问题</h3>
<p class="ziti">很多企业设计MySQL主主复制架构的可能原因是希望增加写并发的能力，但其实双主是否真的能够增加写并发，还有待实践检验，因为一个库写入时，另一个库也会同时写入（由复制进程写入），写入量较大时，从库的写压力也是不小的。</p>
<p class="ziti">如果要切实增加大量用户的写并发请求，那么MySQL主主复制架构可能并不是最好的选择，这里有如下的更优选择可供读者参考。</p>
<p class="ziti">1）分库：例如原本一个数据库服务器里有www/bbs/blog等多个库，那么可以将每个产品库都做成一套集群，这样就可以提高写的压力了，这样的拆分简单有效，DBA或运维人员自己就可以实现，几乎不需要业务程序做任何改动。</p>
<p class="ziti">2）分表：a）横拆——将最常使用的小字段放在一个表里，将不常使用的大字段放在单独的表里，等需要查询大字段表时，再通过连表进行查询；b）纵拆——根据表的记录进行拆分，例如，1000万条记录的一张表，可以根据key或uid将1～1000000条放在第一张表，1000001～2000000条放在第二张表，依此类推拆成10张表，然后前端根据key或uid进行调度决定应去访问哪张表对应的数据。这里的横拆和纵拆需要开发人员的或者数据库研发人员的配合才能完成。</p>
<p class="ziti">3）百度千台数据库集群拆分案例：当单表达到指定的记录数时，自动化扩容拆表，自动化收缩合表，具体详情见后文。</p>
<p class="ziti">老男孩个人建议参考：即使配置了MySQL双主复制，最好也只单写，配置双主的目的并不是为了增加写并发，而是为了实现在主库宕机后角色能够快速切换提供服务。</p>
<p class="ziti">正常主库宕机切换到从库，需要开启binlog功能，取消read-only参数，同时还需要更改Web用户授权等操作，而配置双主就不需要这些操作了，只要进行VIP的切换即可，当然了，后文讲解的MHA访问可以帮我们自动实现这个角色的切换，以及修改参数的过程。</p>
</body>
</html>
