<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" style="font-size:1.250rem;">
<head><title></title>
<link href="flow0001.css" rel="stylesheet" type="text/css" />
</head>
<body>
<h3 class="p3">17.2.2　MySQL半同步复制原理</h3>
<p class="ziti">在半同步复制的模式下，每一个事务都需要等待从库返回正常接收日志数据的信息之后，才会返回给用户更新完毕。如果在更新期间，主从库发生了网络故障或者从库宕机，那么此时主库在事务提交后会等待10秒（默认值），如果10秒内还是不能联系到该从库，就会放弃更新该从库，并向用户返回数据。这时主从库就会恢复到默认的异步复制状态。</p>
<p class="ziti">如果主机间的通信延迟较小，而且更新的事务较小，则半同步复制可以在主库更新性能损失很小的情况下，最大限度地实现某一台从库的零数据丢失。</p>
<p class="ziti">图17-1为MySQL半同步复制的逻辑图，希望读者能够更好地理解半同步复制技术。</p>
<div class="pic"><img alt="" src="Image00127.jpg" />
</div>
<p class="middle-img">图17-1　MySQL半同步复制的逻辑图</p>
<p class="ziti">在上述图17-1所示的逻辑图中，我们可以得知，要实现半同步复制功能，必须要在主从库中同时开启半同步复制功能，并进行适当的配置才行，在实际工作中，至少需要配置一台半同步从服务器，在主服务器更新事务处理返回给用户之前，需要确认更新已经收到并写入了从服务器的中继日志中。当出现连接从服务器超时（默认为10秒）时，主服务器会暂时切换到异步复制模式进行复制，恢复半同步复制模式的从服务器并及时接收来自主库的更新信息。</p>
</body>
</html>
