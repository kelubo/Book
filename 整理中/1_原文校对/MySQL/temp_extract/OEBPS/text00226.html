<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" style="font-size:1.250rem;">
<head><title></title>
<link href="flow0001.css" rel="stylesheet" type="text/css" />
</head>
<body>
<h1 class="p1">第15章　MySQL主从复制高级方案与应用实践</h1>
<h2 class="p2">
<a id="a1">15.1　MySQL集群企业级架构方案</a>
</h2>
<p class="ziti">在实际生产环境中，一主多从的数据库环境是最常采用的数据库架构，那么我们应该怎么分配不同的主从以向用户提供更高效的访问呢？请阅读下文。</p>
<p class="p6">1.根据对数据库的访问请求实现读写分离</p>
<p class="ziti">在实际生产环境中，99%的业务场景都是读多写少，而一主多从的环境恰恰是主不容易扩展，而从更容易增加多台的环境，因此，把更少请求的写访问业务调度到主库上，而把读请求较多的业务调度到多个从库上，就是一个很好的策略。此方案对应的方法和工具已经在第14章中介绍过，此处就不再累述了，后文对本方案的实践还会进行讲解。</p>
<p class="p6">2.根据不同的业务拆分多个从库以提供访问</p>
<p class="ziti">从大的方向来分，用户的请求主要有两种，一个是外部用户的访问请求，一个是内部用户的访问请求。而大多数情况下，都是外部用户访问请求更重要，需要更好的用户体验效果，而对内部用户访问请求的体验要求相对外部来说就要低得多，甚至宕机一段时间也不会有太大的影响。</p>
<p class="ziti">因此，首先要对外部用户和内部用户读数据库的访问请求进行分离，拿一主五从的数据库环境来说，可以让前三个从库（利用读写分离软件或LVS等工具实现负载均衡）提供外部用户读请求访问，让第四个从库用于内部用户读访问（业务后台、数据分析、搜索业务、财务统计、定时任务、开发查询等），让第五个数据库用于数据库定时全备份以及增量备份（开启binlog功能）。整个逻辑图如图15-1所示。</p>
<div class="pic"><img alt="" src="Image00121.jpg" />
</div>
<p class="middle-img">图15-1　MySQL主从复制根据业务重要性拆分从库方案</p>
<p class="p6">3.实现对主库的高可用</p>
<p class="ziti">一主多从的MySQL数据库环境，最脆弱的就是主库了，不但扩展困难，所承受的压力也很大，而且，还会面临宕机没有机器替补的问题。</p>
<p class="ziti">本节为大家介绍的是MySQL的高可用方案。MySQL的高可用方案包含很多种，具体如下。</p>
<p class="ziti">1）heartbeat+dbrd+mysql方案</p>
<p class="ziti">此方案是通过dbrd工具对主数据库服务器实现基于block的异机物理复制（类似于网络raid1），速度很快，但缺点是与备节点对应的复制的数据分区是不可见状态（即不能被访问，除非主节点宕机，备节点才可提供访问），浪费一台机器，早期受MySQL官方推荐，现如今在企业场景中使用的不是很多了，但仍然不失为一套成熟的MySQL高可用方案。</p>
<p class="ziti">2）mysql-MMM（Master-Master replication Manager）方案</p>
<p class="ziti">此方案是通过MySQL的replication实现的主主之间的数据同步，同时还可以实现slaves负载均衡等功能，但业界普遍认为MMM无法完全保持数据的一致性，因此对数据一致性要求较高的数据库场景很少采用，导致该方案也逐步没落了。</p>
<p class="ziti">3）mysql MHA（Master High Availability）+keepalived方案</p>
<p class="ziti">MHA是业界公认的MySQL高可用的相对来说比较成熟的方案，此方案也是通过MySQL的replication实现的数据库服务器之间的数据同步，同时还可以实现从库负载均衡、主库宕机后自动选择最优的从库，将其切换为主库，并尽最大的努力对所有的库做数据补全操作一直到最新，并对其他从库和新主库实现复制，再加上keepalived是为了实现VIP漂移，因此该方案是业界采用较多的方案，也是本书后面将会精讲的方案。</p>
<p class="ziti">4）更多方案将在后续出版的书籍中再与大家探讨，例如，pxc、共享存储方案、分布式方案等。</p>
</body>
</html>
