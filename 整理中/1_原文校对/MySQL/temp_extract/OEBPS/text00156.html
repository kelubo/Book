<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" style="font-size:1.250rem;">
<head><title></title>
<link href="flow0001.css" rel="stylesheet" type="text/css" />
</head>
<body>
<h2 class="p2">11.2　MySQL数据库字符集配置</h2>
<p class="ziti">设置MySQL的字符集需要考虑到很多个层次，老男孩将这些需要考虑的层次大概分为以下7个级别。</p>
<p class="ziti6">·操作系统级别。</p>
<p class="ziti6">·操作系统客户端级别（SSH）。</p>
<p class="ziti6">·MySQL实例级别。</p>
<p class="ziti6">·数据库中的库级别。</p>
<p class="ziti6">·表级别（含字段级别）。</p>
<p class="ziti6">·MySQL客户端级别（连接及返回结果）。</p>
<p class="ziti6">·程序代码级别。</p>
<p class="ziti">下面以Linux系统及UTF8字符集为例进行讲解。</p>
<p class="p6">1.Linux系统服务端字符集设置</p>
<p class="ziti">很多读者在使用MySQL时经常会被中文乱码所困扰，其中Linux系统和连接Linux系统客户端的字符集设置可能就是问题之一，对此，要尽量将系统的字符集和系统中软件的字符集进行统一，设置和生效的方法具体如下：</p>
<hr/>
<pre class="ziti1">[root@oldboy ~]# cat /etc/sysconfig/i18n    #&lt;==配置到配置文件里可以永久生效。
LANG="zh_CN.UTF-8"               #&lt;==LANG为系统字符集环境变量，设置为中文UTF8。
SYSFONT="latarcyrheb-sun16"
[root@oldboy ~]# source /etc/sysconfig/i18n #&lt;==使得修改生效。
[root@oldboy ~]# echo $LANG                 #&lt;==检查生效情况。
zh_CN.UTF-8</pre>
<hr/>
<p class="ziti">如果在Linux服务器里使用MySQL登录到数据库，则请注意系统字符集的使用。</p>
<p class="p6">2.Linux系统客户端字符集设置</p>
<p class="ziti">常见的连接Linux系统的客户端为SecureCRT、XShell，下面我们就来了解一下如何设置字符集的配置。</p>
<p class="ziti">SecureCRT的配置如图11-1所示。</p>
<p class="ziti">XShell的配置如图11-2所示。</p>
<p class="p6">3.MySQL服务端数据库实例字符集设置</p>
<p class="ziti">设置服务器的字符集有很多种方法，下面介绍其中常用的三种。</p>
<div class="pic"><img alt="" src="Image00080.jpg" />
</div>
<p class="middle-img">图11-1　SecureCRT的字符集配置</p>
<div class="pic"><img alt="" src="Image00081.jpg" />
</div>
<p class="middle-img">图11-2　XShell的字符集配置</p>
<p class="ziti">方法1：前文在编译安装MySQL的时候就曾指定过如下的服务器端字符集。</p>
<hr/>
<pre class="ziti1">cmake .
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci \
-DWITH_EXTRA_CHARSETS=all \</pre>
<hr/>
<p class="ziti">方法2：如果编译时没指定字符集，或者指定了不合适的字符集，那么还可以在安装后修改配置文件。</p>
<p class="ziti">可按如下要求更改my.cnf参数：</p>
<hr/>
<pre class="ziti1">[mysqld]
character-set-server=utf8 #&lt;==适合5.5及以后的版本，5.1及以前版本的参数为default-
                            character-set。</pre>
<hr/>
<p class="ziti">方法3：还可以在启动数据库时，增加选项指定的字符集。</p>
<hr/>
<pre class="ziti1">mysqld --character-set-server=utf8 #&lt;==不推荐使用此法。</pre>
<hr/>
<p class="ziti">以上三种方法对数据库的影响具体体现在输出结果中有注释的参数行上，具体如下：</p>
<hr/>
<pre class="ziti1">mysql&gt; show variables like 'character_set%';
+--------------------------+-------------------------------------------+
| Variable_name            | Value                                     |
+--------------------------+-------------------------------------------+
| character_set_client     | utf8                                      |
| character_set_connection | utf8                                      |
| character_set_database   | utf8  #&lt;==MySQL中库的字符集。               |
| character_set_filesystem | binary                                    |
| character_set_results    | utf8                                      |
| character_set_server     | utf8   #&lt;==MySQL服务器实例字符集。           |
| character_set_system     | utf8                                      |
| character_sets_dir       | /application/mysql-5.6.40/share/charsets/ |
+--------------------------+-------------------------------------------+
8 rows in set (0.00 sec)</pre>
<hr/>
<p class="p6">4.MySQL数据库中的库的字符集设置</p>
<p class="ziti">在MySQL中，库的字符集设置一般是在建库的时候指定的，如果在建库的时候未指定，则库的字符集与MySQL数据库实例的字符集一致。可通过如下命令查看当前实例的字符集：</p>
<hr/>
<pre class="ziti1">mysql&gt; show variables like 'character_set_database%';
+------------------------+-------+
| Variable_name          | Value |
+------------------------+-------+
| character_set_database | utf8  |
+------------------------+-------+
1 row in set (0.00 sec)

mysql&gt; show variables like 'collation_database%';
+--------------------+-----------------+
| Variable_name      | Value           |
+--------------------+-----------------+
| collation_database | utf8_general_ci |
+--------------------+-----------------+
1 row in set (0.00 sec)</pre>
<hr/>
<p class="ziti">下面创建数据库test，并查看建库的字符集：</p>
<hr/>
<pre class="ziti1">mysql&gt; create database tingting;
Query OK, 1 row affected (0.00 sec)
mysql&gt; show create database tingting\G
*************************** 1. row ***************************
       Database: tingting
Create Database: CREATE DATABASE `tingting` /*!40100 DEFAULT CHARACTER SET utf8 */
1 row in set (0.00 sec)</pre>
<hr/>
<p class="ziti">在编译MySQL时，若指定了正确的字符集或者修改配置文件调整过的服务器的字符集，那么，在以后建库的时候就可以直接执行简化的命令“create database tinting；”。</p>
<p class="ziti">也可以在建库的时候指定字符集和校对规则来建库，命令如下：</p>
<hr/>
<pre class="ziti1">create database oldboy DEFAULT CHARACTER SET UTF8 DEFAULT COLLATE = utf8_general_ci;</pre>
<hr/>
<p class="ziti">上面的语句为查看已建立的oldboy库的语句，其中，“CHARACTER SET UTF8”即为数据库字符集，而“utf8_general_ci”则为校对规则。</p>
<p class="ziti6"><img alt="" class="formula-1-5em" src="Image00019.jpg" />
 <span class="yanse">注意：</span>
 采用二进制方式安装MySQL时，若没有指定字符集，则此时字符集默认为latin1，此时需要建立设置UTF8字符集的库，即需要指定UTF8字符集建库，否则就必须要提前修改配置文件，将服务器字符集调整为所需要的字符集。</p>
<p class="p6">5.MySQL数据库表的字符集设置</p>
<p class="ziti">默认情况下，建表的字符集与库的字符集应一致，设置表字符集的命令具体如下：</p>
<hr/>
<pre class="ziti1">mysql&gt; use tingting
Database changed
mysql&gt; create table test(id int(4));
Query OK, 0 rows affected (0.03 sec)

mysql&gt; show create table test\G
*************************** 1. row ***************************
       Table: test
Create Table: CREATE TABLE `test` (
  `id` int(4) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8  #&lt;==就是这里，如果在建表时需要调整字符集，
                                       则必须指定字符集。
1 row in set (0.00 sec)</pre>
<hr/>
<p class="p6">6.MySQL数据库客户端字符集设置</p>
<p class="ziti">对MySQL数据库客户端字符集进行设置，对于防止MySQL更新时，出现中文乱码有极大的影响，设置方法也有几种，具体如下。</p>
<p class="ziti">方法1：临时生效单条命令法。</p>
<hr/>
<pre class="ziti1">mysql&gt; set names utf8;
Query OK, 0 rows affected (0.00 sec)</pre>
<hr/>
<p class="ziti">其中，“set names utf8”也可以用下面三个命令来替代。</p>
<hr/>
<pre class="ziti1">SET character_set_client = utf8;
SET character_set_results = utf8;
SET character_set_connection = utf8;</pre>
<hr/>
<p class="ziti">方法2：登录数据库时指定字符集。</p>
<hr/>
<pre class="ziti1">mysql --default-character-set=utf8;</pre>
<hr/>
<p class="ziti">方法3：通过修改my.cnf实现修改MySQL客户端的字符集，配置方法如下。</p>
<hr/>
<pre class="ziti1">[client]
default-character-set=utf8</pre>
<hr/>
<p class="ziti6"><img alt="" class="formula-1-5em" src="Image00019.jpg" />
 <span class="yanse">注意：</span>
 多实例MySQL场景下，这里的字符集修改要统一修改/etc/my.cnf。</p>
<p class="ziti">以上几种方法对数据库的影响具体体现在输出结果中有注释的参数行上，具体如下：</p>
<hr/>
<pre class="ziti1">mysql&gt; show variables like 'character_set%';
+--------------------------+-------------------------------------------+
| Variable_name            | Value                                     |
+--------------------------+-------------------------------------------+
| character_set_client     | utf8  #&lt;==MySQL客户端字符集。               |
| character_set_connection | utf8  #&lt;==MySQL连接的字符集。               |
| character_set_database   | utf8              |
| character_set_filesystem | binary                                    |
| character_set_results    | utf8  #&lt;==MySQL返回结果的字符集。            |
| character_set_server     | utf8          |
| character_set_system     | utf8                                      |
| character_sets_dir       | /application/mysql-5.6.40/share/charsets/ |
+--------------------------+-------------------------------------------+
8 rows in set (0.00 sec)</pre>
<hr/>
<p class="ziti">人工登录数据库执行“set names UTF8”，以及使用MySQL命令指定字符集登录操作，或者更改my.cnf配置文件客户端模块的参数，来实现更改客户端字符集，都是改变了MySQL客户端的client、connection、results 3个参数的字符集。</p>
<p class="p6">7.程序代码字符集</p>
<p class="ziti">很多开源软件都会给出多种字符集的软件代码，例如，bbs软件就是如此。Discuz！X3.2在继承和完善Discuz！X3.1的基础上，针对社区移动端进行了新的尝试，比如，推出微信登录、微社区等功能。它作为安全稳定的程序可为站长提供更加可靠的保障。</p>
<p class="ziti">以下是Discuz！X3.2的下载地址。简体中文GBK的下载地址为：</p>
<p class="ziti">
<a href="http://download.comsenz.com/DiscuzX/3.2/Discuz_X3.2_SC_GBK.zip">http://download.comsenz.com/DiscuzX/3.2/Discuz_X3.2_SC_GBK.zip</a>
</p>
<p class="ziti">简体UTF8的下载地址为：</p>
<p class="ziti">
<a href="http://download.comsenz.com/DiscuzX/3.2/Discuz_X3.2_SC_UTF8.zip">http://download.comsenz.com/DiscuzX/3.2/Discuz_X3.2_SC_UTF8.zip</a>
</p>
<p class="ziti">如果是公司自己开发的产品，则需要咨询开发人员如何搭建符合程序的字符集环境。</p>
</body>
</html>
