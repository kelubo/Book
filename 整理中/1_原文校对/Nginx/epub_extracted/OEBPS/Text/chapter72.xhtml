<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>未知</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="../../stylesheet.css"/>
<link rel="stylesheet" type="text/css" href="../../page_styles.css"/>
</head>
  <body class="calibre"> 
 <h3 class="p" id="sigil_toc_id_81">4.3.2　图片处理</h3> 
 <p class="ziti3">模块名称：ngx_http_image_filter_module</p> 
 <p class="ziti3">该模块可以对JPEG、GIF、PNG或WebP格式的图片文件进行动态旋转、比例缩放及裁剪。该模块的内置配置指令如表4-51～表4-58所示。</p> 
 <p class="middle-img">表4-51　图片处理指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-51.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-51.jpg" class="calibre155"/></a> 
 </div> 
 <p class="middle-img">表4-52　image_filter指令值参数</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-52.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-52.jpg" class="calibre174"/></a> 
 </div> 
 <p class="middle-img">表4-53　图片处理缓冲区指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-53.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-53.jpg" class="calibre175"/></a> 
 </div> 
 <p class="middle-img">表4-54　JEPG图片质量指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-54.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-54.jpg" class="calibre176"/></a> 
 </div> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/119-i.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/119-i.jpg" class="calibre154"/></a> 
 </div> 
 <p class="middle-img">表4-55　WebP图片质量指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-55.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-55.jpg" class="calibre177"/></a> 
 </div> 
 <p class="middle-img">表4-56　图片背景指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-56.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-56.jpg" class="calibre178"/></a> 
 </div> 
 <p class="middle-img">表4-57　图片锐化指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-57.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-57.jpg" class="calibre56"/></a> 
 </div> 
 <p class="middle-img">表4-58　图片交错加载指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-58.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-58.jpg" class="calibre179"/></a> 
 </div> 
 <p class="ziti3">配置样例如下：</p> 
 <hr class="calibre6"/> 
 <pre class="ziti5">upstream img1 {
    server 192.168.2.145:8080;
}

server {
    listen 8083;
    server_name image.nginxtest.org;
    index index.html index.htm index.php;
    image_filter_buffer 20M;                        # 设置图片处理缓冲区大小为20MB
    image_filter_sharpen 150;                       # 对图片进行150%的锐化处理
    image_filter_jpeg_quality 70;                   # JPEG图片的压缩比为70%
    image_filter_transparency off;                  # 对GIF及PNG图片去掉透明背景
    image_filter_interlace on;                      # 将输出图片转换为交错格式

    location / {
        root /opt/nginx-web;
    }
    # 比例缩放图片尺寸file_100x100.jpg 
    location ~* .*_(\d+)x(\d+)\.(JPG|jpg|gif|png|PNG)$ {
        set $img_width $1;                          # 缩放图片的宽
        set $img_height $2;                         # 缩放图片的高
        rewrite ^(.*)_\d+x\d+.(JPG|jpg|gif|png|PNG)$ /images$1.$2 break;
        image_filter resize $img_width $img_height;
        proxy_pass http://img1;
    }
    # 比例缩放图片尺寸并压缩file_100x100_80.jpg 
    location ~* .*_(\d+)x(\d+)_(\d+)\.(JPG|jpg|gif|png|PNG)$ {
        set $img_width $1;                          # 缩放图片的宽
        set $img_height $2;                         # 缩放图片的高
        set $img_quality $3;                        # 图片的质量
        rewrite ^(.*)_\d+x\d+_\d+.(JPG|jpg|gif|png|PNG)$ /images$1.$2 break;
        image_filter resize $img_width $img_height;
        image_filter_jpeg_quality $img_quality;
        proxy_pass http://img1;
    } 

    # 比例缩放图片尺寸并旋转file_100x100__90.jpg 
    location ~* .*_(\d+)x(\d+)__(\d+)\.(JPG|jpg|gif|png|PNG)$ {
        set $img_width $1;                          # 缩放图片的宽
        set $img_height $2;                         # 缩放图片的高
        set $img_rotate $3;                         # 旋转参数
        rewrite ^(.*)_\d+x\d+__\d+.(JPG|jpg|gif|png|PNG)$ /images$1.$2 break;
        image_filter resize $img_width $img_height ;
        image_filter rotate $img_rotate ;
        proxy_pass http://img1;
    } 

    # 裁剪图片尺寸file_100x100_crop.jpg 
    location ~* .*_(\d+)x(\d+)_crop\.(JPG|jpg|gif|png|PNG)$ {
        set $img_width $1;                          # 裁剪图片的宽
        set $img_height $2;                         # 裁剪图片的高
        rewrite ^(.*)_\d+x\d+_crop.(JPG|jpg|gif|png|PNG)$ /images$1.$2 break;
        image_filter crop $img_width $img_height;
        proxy_pass http://img1;
    } 
}
</pre> 
 <hr class="calibre6"/> 
 <p class="ziti3">模块：ngx_http_empty_gif_module</p> 
 <p class="ziti3">该模块将在内存中创建一个单像素的GIF透明图片。该模块的内置配置指令如表4-59所示。</p> 
 <p class="middle-img">表4-59　空图片指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-59.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-59.jpg" class="calibre180"/></a> 
 </div> 
 <p class="ziti3">配置样例如下：</p> 
 <hr class="calibre6"/> 
 <pre class="ziti5">location = /_.gif {
    empty_gif;
}
</pre> 
 <hr class="calibre6"/> 
</body>
</html>
