<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>未知</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="../../stylesheet.css"/>
<link rel="stylesheet" type="text/css" href="../../page_styles.css"/>
</head>
  <body class="calibre"> 
 <h3 class="p" id="sigil_toc_id_71">4.2.2　referer请求头控制模块</h3> 
 <p class="ziti3">模块名称：ngx_http_referer_module</p> 
 <p class="ziti3">referer请求头控制模块可以通过设置请求头中的属性字段Referer的值控制访问的拒绝与允许。Referer字段用来表示当前请求的跳转来源，由于该字段可能会涉及隐私权问题，部分浏览器允许用户不发送该属性字段，因此也会存在浏览器正常的请求头中无Referer字段的情况。另外，有些代理服务器或防火墙也会把Referer字段过滤掉。通常情况下，伪造Referer字段的内容是很容易的，因此该模块主要用于浏览器正常发送请求中Referer值的过滤。虽然通过Referer字段进行来源控制并不十分可靠，但用在防盗链的场景中还是基本可以满足需求的。该模块的内置配置指令如表4-17～表4-19所示。</p> 
 <p class="middle-img">表4-17　referer哈希表大小指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-17.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-17.jpg" class="calibre35"/></a> 
 </div> 
 <p class="middle-img">表4-18　referer哈希桶大小指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-18.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-18.jpg" class="calibre150"/></a> 
 </div> 
 <p class="middle-img">表4-19　有效referer值指令</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-19.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-19.jpg" class="calibre151"/></a> 
 </div> 
 <p class="ziti3">referer指令值参数如表4-20所示。</p> 
 <p class="middle-img">表4-20　referer指令值参数</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b4-20.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b4-20.jpg" class="calibre152"/></a> 
 </div> 
 <p class="ziti3">配置样例如下：</p> 
 <hr class="calibre6"/> 
 <pre class="ziti5">server{
    listen 8080;
    server_name nginxtest.org;
    root /opt/nginx-web/www;
    valid_referers none blocked *.nginxtest.org; 
         # 当Referer为空或内容不包含“http://”或以“https://”开头的主机名为“*.nginxtest.
        # org”时允许访问
    if ($invalid_referer) {
        return 403;
    }
}
</pre> 
 <hr class="calibre6"/> 
 <p class="ziti4">·指令值为字符串时，既可以是包含前缀或后缀的主机名，也可以是包含主机名的URI。</p> 
 <p class="ziti4">·指令值为正则表达式时，必须以~开头，Nginx将从“http://”或“https://”之后的字符串开始匹配。</p> 
 <p class="ziti4">·默认变量$invalid_referer的值为1，当Referer的值与指令值的内容匹配时，$invalid_referer的值为空。</p> 
</body>
</html>
