<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>未知</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="../../stylesheet.css"/>
<link rel="stylesheet" type="text/css" href="../../page_styles.css"/>
</head>
  <body class="calibre"> 
 <h3 class="p" id="sigil_toc_id_153">8.1.2　负载均衡策略指令</h3> 
 <p class="ziti3">Nginx支持多种负载均衡策略，如轮询（Round Robin）、一致性哈希（Consistent Hash）、IP哈希（IP Hash）、最少连接（least_conn）等。Nginx的默认负载均衡策略为轮询策略，不需要配置指令，轮询策略通过server的权重参数可实现手动分配的加权轮询策略。负载均衡策略配置指令均应编辑在upstream指令域的最上方，常见的配置指令如表8-7～表8-10所示。</p> 
 <p class="middle-img">表8-7　哈希策略</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b8-7.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b8-7.jpg" class="calibre277"/></a> 
 </div> 
 <p class="ziti3">配置样例如下：</p> 
 <hr class="calibre6"/> 
 <pre class="ziti5">upstream backend {
    hash $request_uri;              # 以客户端请求URI为计算哈希值的key
    ...
}

upstream backend {
    hash $request_uri consistent;   # 以客户端请求URI为计算哈希值的key，采用一致性哈希算法
    ...
}
</pre> 
 <hr class="calibre6"/> 
 <p class="middle-img">表8-8　IP哈希策略</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b8-8.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b8-8.jpg" class="calibre278"/></a> 
 </div> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/235-i.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/235-i.jpg" class="calibre279"/></a> 
 </div> 
 <p class="ziti3">配置样例如下：</p> 
 <hr class="calibre6"/> 
 <pre class="ziti5">upstream backend {
    ip_hash;                # 启用IP哈希负载均衡策略
    server backend1.example.com;
    server backend2.example.com;
    server backend3.example.com down;
    server backend4.example.com;
}
</pre> 
 <hr class="calibre6"/> 
 <p class="ziti3">当服务器组中一台服务器被临时删除时，可使用down参数标记，那么客户端IP哈希值将会保留。</p> 
 <p class="middle-img">表8-9　最少连接策略</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b8-9.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b8-9.jpg" class="calibre280"/></a> 
 </div> 
 <p class="ziti3">配置样例如下：</p> 
 <hr class="calibre6"/> 
 <pre class="ziti5">upstream backend {
    least_conn;             # 启用最少连接负载均衡策略
    server backend1.example.com;
    server backend2.example.com;
    server backend4.example.com;
}
</pre> 
 <hr class="calibre6"/> 
 <p class="middle-img">表8-10　随机负载策略</p> 
 <div class="pic"> 
  <a href="http://popImage?src='../Images/b8-10.jpg'" class="pcalibre calibre1"><img alt="" src="../Images/b8-10.jpg" class="calibre169"/></a> 
 </div> 
 <p class="ziti3">配置样例如下：</p> 
 <hr class="calibre6"/> 
 <pre class="ziti5">upstream backend {
    random;                 # 每个请求都被随机发送到某个服务器
    server backend1.example.com;
    server backend2.example.com;
    server backend4.example.com;
}
</pre> 
 <hr class="calibre6"/> 
 <p class="ziti4">·指令值参数two，该参数表示随机选择两台被代理服务器，然后使用指定的负载策略进行选择，默认方法为least_conn。</p> 
 <p class="ziti4">·可被指定的负载策略为least_conn、least_time（仅对商业版有效）。</p> 
</body>
</html>
